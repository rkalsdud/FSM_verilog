## 개요
서강대학교 컴퓨터공학실험2 에서 실험한 내용 중,   
비트 시퀀스 "10101" 을 감지하는 Sequence Detector를 Moore, Mealy 머신으로 구현한 기록
## 상태 정의
  S0: 초기 상태  
  S1: "1" 이 감지된 상태  
  S2: "10" 이 감지된 상태  
  S3: "101" 이 감지된 상태  
  S4: "1010" 이 감지된 상태  
  S5: "10101" 이 감지된 상태

Moore 머신은 S5까지 상태가 정의되어 있어야 하지만 Mealy 머신은 S4까지의 상태만을 활용한다. 

## 디자인 파일
### 구현 1 (standard FSM)
case 문을 사용해서 state diagram에 나타난 FSM의 동작을 구현했다.

- 변수의 의미
  - input  
    x는 입력, clk는 클럭 신호, reset은 리셋 신호(active low)를 의미한다.  
  - output reg  
    state는 현재 상태를 의미하는 배열이다. 4~5가지의 상태를 표현하기 위해 3비트로 선언했다. Z는 비트 시퀀스 "10101"가 감지됐음을 나타내는 출력이다. 

- Moore 머신의 동작  
  1. case문에 현재 상태가 주어졌을 때, 입력 x의 값에 따라 다음 상태 nextState에 적절한 값을 할당한다.
  2. 리셋 신호의 하강 엣지 시점에 현재 상태를 리셋시킨다.
  3. 리셋 신호가 high이면서 클럭의 상승 엣지가 발생한다면 현재 상태에 nextState를 할당한다.
  4. 현재 상태가 S5라면 출력 z를 활성화한다.
 
- Mealy 머신의 동작
  1. case문에 현재 상태가 주어졌을 때, 입력 x의 값에 따라 다음 상태 nextState에 적절한 값을 할당한다.
  2. 리셋 신호의 하강 엣지 시점에 현재 상태를 리셋시킨다.
  3. 리셋 신호가 high이면서 클럭의 상승 엣지가 발생한다면 현재 상태에 nextState를 할당한다.
  4. 현재 상태가 S4이면서 x가 high라면 출력 z를 활성화한다. 
  
### 구현 2 (shift register)
SIPO 형식의 shift register를 응용해서 sequence detector를 구현할 수도 있다. 

- 변수의 의미  
  - input   
    x는 입력, clk는 클럭 신호, reset은 리셋 신호를 의미한다.
  - output reg  
    Q는 최근의 입력들을 저장하는 배열이다. Z는 비트 시퀀스 "10101"가 감지됐음을 나타내는 출력이다. 

- Moore 머신의 동작 
  1. 클럭의 상승 엣지가 발생했을 때 배열 Q의 각 비트를 왼쪽으로 한 자리씩 이동시키고 LSB를 입력 x로 채운다.
  2. Q가 10101과 일치하는 경우 z를 활성화한다.

- Mealy 머신의 동작
  1. 클럭의 상승 엣지가 발생했을 때 배열 Q가 1010이면서 입력이 활성화되어 있다면 z를 활성화한다.
  2. Q의 각 비트를 왼쪽으로 한 자리씩 이동시키고 LSB를 입력 x로 채운다.  

통상적으로 FSM을 구현할 때는 case 문을 이용하지만, sequence detector를 구현할 때에는 shift register를 이용하는 것이 코드를 간결하고 직관적으글 주기는 서로소로 설정하였다. 그렇지 않았다면 서로 다른 입력과 클럭의 경우를 관측하지 못하고, 같은 조합만이 되풀이 될 것이다. (ex. 클럭 high & 입력 high) 


## 시뮬레이션
### standard FSM
- 시뮬레이션 결과  
  - 리셋 신호가 low일 때 state가 0, 출력 z또한 0을 가졌다.
  - 클럭이 상승 엣지인 순간에만 state가 해당 시점의 x에 따라 변했다.

- Moore 머신과 Mealy 머신에서의 차이점
  - Moore  
    state가 5가 되는 시점에 출력 z가 활성화됐다.
  - Mealy  
    클럭에 상관없이 state가 4이면서 x가 활성화된 시점에 출력 z가 활성화됐다. (출력 z가 조합 회로이기 때문이다.)

### shift register
 - 시뮬레이션 결과
   - 리셋 신호가 low일 때 Q가 0, 출력 z또한 0을 가졌다. 
   - 클럭이 상승 엣지인 순간에만 Q의 각 비트가 한 자리씩 왼쪽으로 밀리고, LSB가 해당 시점의 입력 x값으로 채워졌다.

- Moore 머신과 Mealy 머신에서의 차이점
  - Moore  
    Q의 값이 10101이 되는 시점에 출력 z가 활성화됐다. 
  - Mealy  
    Q의 값이 1010이면서 입력이 활성화되는 시점에 출력 z가 활성화됐다. 

## FPGA 검증
### standard FSM
- 핀 할당  
  - 클럭 clk  
    SWITCH_UP을 할당했다. 버튼이 눌릴 때마다 클럭 상승이 발생한다.
  - 리셋 reset  
    SWITCH_1을 할당했다. 스위치가 활성화 되어있다면 리셋 reset이 활성화되어 있는 상태이다. 
  - 입력 x  
    SWITCH_0을 할당했다. 스위치가 활성화 되어있다면 입력 x가 활성화되어 있는 상태이다.
  - 배열 state  
    LED_0...2을 할당했다. state의 MSB부터 LSB를 나타낸다.
  - 출력 z  
    LED_4를 할당했다. 비트 시퀀스 "10101"이 발생했음을 나타낸다.

  - FPGA 동작 결과  
    - 리셋
      SWITCH_1이 내려가있을 때, 다른 입력에 상관없이 state가 S0로 유지됐다.
    - 상승 엣지  
      SWITCH_UP을 누르는 시점에 입력 x의 값에 따라 출력 되는 LED_0...2, LED_4가 달라졌다. 
    - z 출력  
      Moore 머신에서는 state 출력이 3'b101이 되는 시점에 z 출력이 활성화되었다.  
      Mealy 머신에서는 state 출력이 3'b100이면서 입력 x 가 활성화되는 시점에 z 출력이 활성화되었다.
### shift register
- 핀 할당
  - 클럭 clk  
    SWITCH_UP을 할당했다. 버튼이 눌릴 때마다 클럭 상승이 발생한다.
  - 리셋 reset  
    SWITCH_1을 할당했다. 스위치가 활성화 되어있다면 리셋 reset이 활성화되어 있는 상태이다. 
  - 입력 x  
    SWITCH_0을 할당했다. 스위치가 활성화 되어있다면 입력 x가 활성화되어 있는 상태이다. 
  - 배열 Q  
    LED_0...4을 할당했다. Q의 LSB부터 MSB를 나타낸다. Mealy 머신에서는 LED_0...3을 할당했다. 
  - 출력 z  
    LED_6을 할당했다. 비트 시퀀스 "10101"이 발생했음을 나타낸다.

- FPGA 동작 결과
  - 리셋  
    SWITCH_1이 내려가있을 때, 다른 입력에 상관없이 state가 S0 상태로 유지됐다.
  - 상승 엣지  
    SWITCH_UP을 누르는 시점에 LED_0...4가 한 칸 씩 왼쪽으로 밀렸다.
  - 입력 활성화에 따른 배열 출력  
    LSB는 SWITCH_0이 활성화 됐을 때 같이 활성화 되었다.
  - z 출력  
    Moore 머신에서는 배열 출력이 10101이 되는 시점에 z 출력이 활성화되었다.  
    Mealy 머신에서는 배열 출력이 1010이면서 입력 x가 활성화되는 시점에 z 출력이 활성화되었다. 
  
